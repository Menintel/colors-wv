<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="colors.Views.ColorPickerPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:colors.Views"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Grid Grid.Row="0" Padding="24" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}">
            <StackPanel>
                <TextBlock Text="Screen Color Picker" FontSize="24" FontWeight="SemiBold"/>
                <TextBlock Text="Pick colors from anywhere on your screen" Foreground="{ThemeResource TextFillColorSecondaryBrush}" Margin="0,4,0,0"/>
            </StackPanel>
        </Grid>

        <!-- Content -->
        <Grid Grid.Row="1" Padding="24">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" MaxWidth="400"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Left: Picker Controls -->
            <StackPanel Grid.Column="0" Spacing="24">
               <!-- Live Color Preview -->
                <StackPanel 
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                    Padding="24" 
                    CornerRadius="8"
                    Spacing="16">
                    
                    <TextBlock Text="Color Picker" FontSize="18" FontWeight="SemiBold"/>

                    <!-- Large Color Swatch -->
                    <Border 
                        x:Name="LiveColorSwatch"
                        Height="150" 
                        CornerRadius="8"
                        Background="#808080"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="2"/>

                    <!-- Color Values -->
                    <StackPanel Spacing="8">
                        <TextBlock x:Name="HexValue" Text="HEX: #808080" FontSize="16" FontWeight="SemiBold"/>
                        <TextBlock x:Name="RgbValue" Text="RGB: (128, 128, 128)" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        <TextBlock x:Name="PositionValue" Text="Position: (0, 0)" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                    </StackPanel>

                    <!-- Picker Button -->
                    <Button 
                        x:Name="StartPickerButton"
                        Click="StartPickerButton_Click"
                        HorizontalAlignment="Stretch"
                        Style="{StaticResource AccentButtonStyle}">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon Glyph="&#xEF3C;"/>
                            <TextBlock Text="Start Picking"/>
                        </StackPanel>
                    </Button>

                    <TextBlock 
                        x:Name="InstructionText"
                        Text="Click the button above to start picking colors from your screen. Press ESC to stop."
                        TextWrapping="Wrap"
                        Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>

                </StackPanel> 

                <!-- Quick Actions -->
                <StackPanel 
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                    Padding="24" 
                    CornerRadius="8"
                    Spacing="12">
                    
                    <TextBlock Text="Quick Actions" FontSize="18" FontWeight="SemiBold"/>
                    
                    <Button 
                        x:Name="CopyHexButton"
                        Click="CopyHexButton_Click"
                        HorizontalAlignment="Stretch"
                        IsEnabled="False">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon Glyph="&#xE8C8;"/>
                            <TextBlock Text="Copy HEX"/>
                        </StackPanel>
                    </Button>
                    
                    <Button 
                        x:Name="CopyRgbButton"
                        Click="CopyRgbButton_Click"
                        HorizontalAlignment="Stretch"
                        IsEnabled="False">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon Glyph="&#xE8C8;"/>
                            <TextBlock Text="Copy RGB"/>
                        </StackPanel>
                    </Button>
                    
                    <Button 
                        x:Name="SaveColorButton"
                        Click="SaveColorButton_Click"
                        HorizontalAlignment="Stretch"
                        IsEnabled="False">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon Glyph="&#xE74E;"/>
                            <TextBlock Text="Save to History"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </StackPanel>

            <!-- Right: Color History -->
            <StackPanel Grid.Column="1" Margin="24,0,0,0">
                <Grid Margin="0,0,0,16">
                    <TextBlock Text="Color History" FontSize="18" FontWeight="SemiBold"/>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Spacing="8">
                        <Button Content="Refresh" Click="RefreshHistory_Click" Style="{StaticResource SubtleButtonStyle}"/>
                        <Button Content="Clear All" Click="ClearHistory_Click" Style="{StaticResource SubtleButtonStyle}"/>
                    </StackPanel>
                </Grid>

                <ListView x:Name="ColorHistoryList" MaxHeight="600" SelectionMode="None">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <Grid 
                                Margin="0,0,0,12" 
                                Padding="16" 
                                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                                CornerRadius="8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="80"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Color Swatch -->
                                <Border 
                                    Grid.Column="0"
                                    Width="64" 
                                    Height="64" 
                                    CornerRadius="8">
                                    <Border.Background>
                                        <SolidColorBrush Color="{Binding WindowsColor}"/>
                                    </Border.Background>
                                </Border>

                                <!-- Color Info -->
                                <StackPanel Grid.Column="1" Margin="16,0,0,0" VerticalAlignment="Center" Spacing="4">
                                    <TextBlock Text="{Binding HexColor}" FontWeight="SemiBold" FontSize="16"/>
                                    <TextBlock Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                        <Run Text="RGB("/>
                                        <Run Text="{Binding R}"/><Run Text=", "/>
                                        <Run Text="{Binding G}"/><Run Text=", "/>
                                        <Run Text="{Binding B}"/><Run Text=")"/>
                                    </TextBlock>
                                    <TextBlock Text="{Binding CreatedAt}" Foreground="{ThemeResource TextFillColorTertiaryBrush}" FontSize="12"/>
                                </StackPanel>

                                <!-- Actions -->
                                <StackPanel Grid.Column="2" VerticalAlignment="Center" Spacing="4">
                                    <Button 
                                        Content="Copy" 
                                        Click="CopyHistoryColor_Click"
                                        Tag="{Binding}"
                                        Width="80"/>
                                    <Button 
                                        Content="Delete" 
                                        Click="DeleteHistoryColor_Click"
                                        Tag="{Binding}"
                                        Width="80"/>
                                </StackPanel>
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                    <ListView.ItemContainerStyle>
                        <Style TargetType="ListViewItem">
                            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                            <Setter Property="Padding" Value="0"/>
                            <Setter Property="Margin" Value="0,0,0,4"/>
                        </Style>
                    </ListView.ItemContainerStyle>
                </ListView>

                <!-- Empty State -->
                <StackPanel 
                    x:Name="EmptyHistoryState"
                    VerticalAlignment="Center" 
                    HorizontalAlignment="Center"
                    Margin="0,100,0,0">
                    <TextBlock 
                        Text="No colors picked yet" 
                        FontSize="16" 
                        Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                        TextAlignment="Center"/>
                    <TextBlock 
                        Text="Start picking colors to build your history" 
                        Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                        TextAlignment="Center"
                        Margin="0,4,0,0"/>
                </StackPanel>
            </StackPanel>
        </Grid>
    </Grid>
</Page>
